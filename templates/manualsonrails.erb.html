<%
	def visit_heading(heading, result = "")
		result << %Q{<li><a href="#{h heading.basename}#{h heading.anchor}">#{h heading.title_without_numbers}</a></li>}
		if heading.level <= 2
			result << "<ul>\n"
			heading.children.each do |h|
				visit_heading(h, result)
			end
			result << "</ul>\n"
		end
		return result
	end
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />    
	<title><%- if multi_page? && !is_preamble? -%><%=h current_chapter.title_without_numbers %> :: <% end %><%=h title %>
	</title>
	<link href="http://manuals.rubyonrails.org/stylesheets/base.css" media="screen" rel="Stylesheet" type="text/css" />
	<link href="http://manuals.rubyonrails.org/stylesheets/forms.css" media="screen" rel="Stylesheet" type="text/css" />
	<link href="http://manuals.rubyonrails.org/stylesheets/more.css" media="screen" rel="Stylesheet" type="text/css" />
	<style type="text/css">
		<%= include_file('manualsonrails.css') %>
	</style>
</head>
<body>
	<div id="header">			
		<div id="logo">
			<a href="http://www.rubyonrails.org/" title="Ruby on Rails"><img src="http://web.rubyonrails.com/images/rails_logo_remix.gif" alt="Rails" height="140" width="110" /></a>
		</div>

		<ul id="navMain">
			<li class="first-child"><a href="http://www.rubyonrails.org/" title="Ruby on Rails" class="ruby_on_rails">Ruby on Rails</a></li>
			<li><a class="manuals" href="http://manuals.rubyonrails.org/" title="Manuals Index">Manuals Index</a></li>
		</ul>
	</div>

	<div id="container">
		<div id="sidebar">
			<h2>Chapters</h2>
			<%- if multi_page? -%>
				<a href="<%=h chapters.first.basename %>">Preamble</a>
			<%- end -%>
			<ol>
				<%- for heading in table_of_contents -%>
					<%= visit_heading(heading) %>
				<%- end -%>
			</ol>
		</div>
		<div id="content">
			<%- if multi_page? && !is_preamble? -%>
				<h2 id="<%=h current_chapter.anchor_id %>"><%=h current_chapter.title %></h2>
			<%- else -%>
				<h1><%=h title %></h1>
			<%- end -%>
			<%= contents %>
			<div id="chapter_navigation">
				<%- if prev_chapter -%>
					<div class="left-floaty">
					<a href="<%=h prev_chapter.basename %><%=h prev_chapter.anchor %>">&laquo; <%=h prev_chapter.title %></a>
					</div>
				<%- end -%>
				<%- if next_chapter -%>
					<div class="right-floaty">
					<a href="<%=h next_chapter.basename %><%=h next_chapter.anchor %>"><%=h next_chapter.title %> &raquo;</a>
					</div>
				<%- end -%>
			</div>
		</div>
	</div>
</div>
