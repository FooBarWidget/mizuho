<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.3.1" />
<title>Music Filter</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revision {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble,
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-right: 10%;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock {
  margin-right: 0%;
}
div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
div.imageblock img { border: 1px solid silver; }
span.image img { border-style: none; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
</head>
<body>
<div id="header">
<h1>Music Filter</h1>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>The <em>AsciiDoc</em> distribution includes a Music Block filter that
translates music in <a href="http://lilypond.org/">LilyPond</a> or
<a href="http://abcnotation.org.uk/">ABC</a> notation to standard classical
notation in the form of a trimmed PNG image which is automatically
inserted into the <em>AsciiDoc</em> output document (see the <a href="#X1">examples below</a>).</p></div>
<div class="paragraph"><p>Actually the filter (<tt>./filters/music2png.py</tt>) can be used outside
<em>AsciiDoc</em> to convert LilyPond or ABC music files to PNG images.
Execute the following command to see how to use it:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ ./filters/music2png.py --help</tt></pre>
</div></div>
<div class="paragraph"><p>The Music Filter can be used as a model for filters that convert a
block of text into a file that is linked or embedded into the <em>AsciiDoc</em>
output document.</p></div>
<div class="exampleblock" id="X1">
<div class="title">Example 1: Music Block containing ABC notation</div>
<div class="exampleblock-content">
<div class="paragraph"><p>This Music Block:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt> ["music","music1.png",scaledwidth="100%"]
 ---------------------------------------------------------------------
 T:The Butterfly
 R:slip jig
 C:Tommy Potts
 H:Fiddle player Tommy Potts made this tune from two older slip jigs,
 H:one of which is called "Skin the Peelers" in Roche's collection.
 H:This version by Peter Cooper.
 D:Bothy Band: 1975.
 M:9/8
 K:Em
 vB2(E G2)(E F3)|B2(E G2)(E F)ED|vB2(E G2)(E F3)|(B2d) d2(uB A)FD:|
 |:(vB2c) (e2f) g3|(uB2d) (g2e) (dBA)|(B2c) (e2f) g2(ua|b2a) (g2e) (dBA):|
 |:~B3 (B2A) G2A|~B3 BA(uB d)BA|~B3 (B2A) G2(A|B2d) (g2e) (dBA):|
 ---------------------------------------------------------------------</tt></pre>
</div></div>
<div class="paragraph"><p>Renders:</p></div>
<div class="musicblock">
<div class="content">
<img style="border-width: 0;" src="music1.png" alt="music1.png" />
</div></div>
</div></div>
<div class="exampleblock" id="X2">
<div class="title">Example 2: Music Block containing LilyPond notation</div>
<div class="exampleblock-content">
<div class="paragraph"><p>This example contains LilyPond musical markup, it uses the <em>link</em>
attribute so you can click on the music image to display the source
notation. The <tt>music2.ly</tt> source file is automatically created and
retained by the <tt>music2png.py</tt> filter when the <tt>-m</tt> option is used.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt> ["music", "music2.png", "ly", link="music2.ly"]
 ---------------------------------------------------------------------
 \version "2.10.0"
 \paper {
   ragged-right = ##t
 }
 {
   \time 3/4
   \clef bass
   c2 e4 g2. f4 e d c2 r4
 }
 ---------------------------------------------------------------------</tt></pre>
</div></div>
<div class="paragraph"><p>Renders:</p></div>
<div class="musicblock">
<div class="content">
<a href="music2.ly">
<img style="border-width: 0;" src="music2.png" alt="music2.png" />
</a>
</div></div>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If you get an error processing the above example it may be that
it is not compatible with your version of LilyPond. Use the LilyPond
<tt>convert-ly(1)</tt> utility to update the source to the version that you
are using.</td>
</tr></table>
</div>
</div>
</div>
<h2 id="_using_the_filter">Using the Filter</h2>
<div class="sectionbody">
<div class="paragraph"><p>Insert a delimited Music Block containing valid ABC notation into your
<em>AsciiDoc</em> document:</p></div>
<div class="ulist"><ul>
<li>
<p>
The Music Block delimiter is the word <tt>music</tt> followed by four or
  more tilde characters.
</p>
</li>
<li>
<p>
The Music Block attribute list must contain a file name for the PNG
  output image file followed by the input format (either <em>abc</em> for ABC
  or <em>ly</em> for LilyPond). If the format is omitted ABC notation is
  assumed.
</p>
</li>
<li>
<p>
The filter invokes <tt>music2png</tt> with the <tt>-m</tt> option so that music
  images will only be regenerated if the block content has changed.
</p>
</li>
<li>
<p>
The optional named block attributes <em>link</em>, <em>width</em> and <em>height</em> are
  also available (see <a href="userguide.html#X55">Image macro attributes</a>
  in the <em>AsciiDoc</em> User Guide).
</p>
</li>
</ul></div>
</div>
<h2 id="_limitations">Limitations</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
The <tt><tt>asciidoc(1)</tt></tt> output file cannot be <tt>-</tt> (stdout), you must
  output to a named file.
</p>
</li>
<li>
<p>
If the music image file is linked to the output document then the
  image file name in the Music Block attribute list should be a
  relative path name relative to the <em>AsciiDoc</em> output file.
</p>
</li>
</ul></div>
</div>
<h2 id="_installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph"><p>In addition to <em>AsciiDoc</em> you will need to have installed:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://lilypond.org/web/">LilyPond</a> (most Linux distributions include
  this package).
</p>
</li>
<li>
<p>
<a href="http://www.imagemagick.org">ImageMagick</a> (most Linux distributions
  include this package).
</p>
</li>
</ul></div>
<div class="paragraph"><p>Test the music filter it by converting the test file to HTML with <em>AsciiDoc</em>:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ asciidoc -v ./filters/music-filter-test.txt
$ firefox ./filters/music-filter-test.html &amp;</tt></pre>
</div></div>
<div class="paragraph"><p>The filter was developed and tested on Xubuntu Linux using LilyPond
2.10.5 and ImageMagick 6.2.4.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The filter does not work with LilyPond 2.2.6 because it did not
generate the requested output file name correctly (2.6.3 does not have
a problem).</td>
</tr></table>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2008-12-31 14:47:04 NZDT
</div>
</div>
</body>
</html>
